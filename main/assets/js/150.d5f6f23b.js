(window.webpackJsonp=window.webpackJsonp||[]).push([[150],{712:function(e,a,t){"use strict";t.r(a);var c=t(1),l=Object(c.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"interfaces"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#interfaces"}},[e._v("#")]),e._v(" Interfaces")]),e._v(" "),t("p",[e._v("The callbacks middleware requires certain interfaces to be implemented by the underlying IBC applications and the secondary application. If you're simply wiring up the callbacks middleware to an existing IBC application stack and a secondary application such as "),t("code",[e._v("icacontroller")]),e._v(" and "),t("code",[e._v("x/wasm")]),e._v(", you can skip this section.")]),e._v(" "),t("h2",{attrs:{id:"interfaces-for-developing-the-underlying-ibc-application"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#interfaces-for-developing-the-underlying-ibc-application"}},[e._v("#")]),e._v(" Interfaces for developing the Underlying IBC Application")]),e._v(" "),t("h3",{attrs:{id:"packetdataunmarshaler"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#packetdataunmarshaler"}},[e._v("#")]),e._v(" "),t("code",[e._v("PacketDataUnmarshaler")])]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gUGFja2V0RGF0YVVubWFyc2hhbGVyIGRlZmluZXMgYW4gb3B0aW9uYWwgaW50ZXJmYWNlIHdoaWNoIGFsbG93cyBhIG1pZGRsZXdhcmUgdG8KLy8gcmVxdWVzdCB0aGUgcGFja2V0IGRhdGEgdG8gYmUgdW5tYXJzaGFsZWQgYnkgdGhlIGJhc2UgYXBwbGljYXRpb24uCnR5cGUgUGFja2V0RGF0YVVubWFyc2hhbGVyIGludGVyZmFjZSB7CiAgLy8gVW5tYXJzaGFsUGFja2V0RGF0YSB1bm1hcnNoYWxzIHRoZSBwYWNrZXQgZGF0YSBpbnRvIGEgY29uY3JldGUgdHlwZQogIFVubWFyc2hhbFBhY2tldERhdGEoW11ieXRlKSAoaW50ZXJmYWNle30sIGVycm9yKQp9Cg=="}}),e._v(" "),t("p",[e._v("The callbacks middleware "),t("strong",[e._v("requires")]),e._v(" the underlying ibc application to implement the "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/release/v7.3.x/modules/core/05-port/types/module.go#L142-L147",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("PacketDataUnmarshaler")]),t("OutboundLink")],1),e._v(" interface so that it can unmarshal the packet data bytes into the appropriate packet data type. This allows usage of interface functions implemented by the packet data type. The packet data type is expected to implement the "),t("code",[e._v("PacketDataProvider")]),e._v(" interface (see section below), which is used to parse the callback data that is currently stored in the packet memo field for "),t("code",[e._v("transfer")]),e._v(" and "),t("code",[e._v("ica")]),e._v(" packets as a JSON string. See its implementation in the "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/release/v7.3.x/modules/apps/transfer/ibc_module.go#L303-L313",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("transfer")]),t("OutboundLink")],1),e._v(" and "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/release/v7.3.x/modules/apps/27-interchain-accounts/controller/ibc_middleware.go#L258-L268",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("icacontroller")]),t("OutboundLink")],1),e._v(" modules for reference.")]),e._v(" "),t("p",[e._v("If the underlying application is a middleware itself, then it can implement this interface by simply passing the function call to its underlying application. See its implementation in the "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/release/v7.3.x/modules/apps/29-fee/ibc_middleware.go#L368-L378",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("fee middleware")]),t("OutboundLink")],1),e._v(" for reference.")]),e._v(" "),t("h3",{attrs:{id:"packetdataprovider"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#packetdataprovider"}},[e._v("#")]),e._v(" "),t("code",[e._v("PacketDataProvider")])]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gUGFja2V0RGF0YVByb3ZpZGVyIGRlZmluZXMgYW4gb3B0aW9uYWwgaW50ZXJmYWNlcyBmb3IgcmV0cmlldmluZyBjdXN0b20gcGFja2V0IGRhdGEgc3RvcmVkIG9uIGJlaGFsZiBvZiBhbm90aGVyIGFwcGxpY2F0aW9uLgovLyBBbiBleGlzdGluZyBwcm9ibGVtIGluIHRoZSBJQkMgbWlkZGxld2FyZSBkZXNpZ24gaXMgdGhlIGluYWJpbGl0eSBmb3IgYSBtaWRkbGV3YXJlIHRvIGRlZmluZSBpdHMgb3duIHBhY2tldCBkYXRhIHR5cGUgYW5kIGluc2VydCBwYWNrZXQgc2VuZGVyIHByb3ZpZGVkIGluZm9ybWF0aW9uLgovLyBBIHNob3J0IHRlcm0gc29sdXRpb24gd2FzIGludHJvZHVjZWQgaW50byBzZXZlcmFsIGFwcGxpY2F0aW9uJ3MgcGFja2V0IGRhdGEgdG8gdXRpbGl6ZSBhIG1lbW8gZmllbGQgdG8gY2FycnkgdGhpcyBpbmZvcm1hdGlvbiBvbiBiZWhhbGYgb2YgYW5vdGhlciBhcHBsaWNhdGlvbi4KLy8gVGhpcyBpbnRlcmZhY2VzIHN0YW5kYXJkaXplcyB0aGF0IGJlaGF2aW91ci4gVXBvbiByZWFsaXphdGlvbiBvZiB0aGUgYWJpbGl0eSBmb3IgbWlkZGxld2FyZSdzIHRvIGRlZmluZSB0aGVpciBvd24gcGFja2V0IGRhdGEgdHlwZXMsIHRoaXMgaW50ZXJmYWNlIHdpbGwgYmUgZGVwcmVjYXRlZCBhbmQgcmVtb3ZlZCB3aXRoIHRpbWUuCnR5cGUgUGFja2V0RGF0YVByb3ZpZGVyIGludGVyZmFjZSB7CiAgLy8gR2V0Q3VzdG9tUGFja2V0RGF0YSByZXR1cm5zIHRoZSBwYWNrZXQgZGF0YSBoZWxkIG9uIGJlaGFsZiBvZiBhbm90aGVyIGFwcGxpY2F0aW9uLgogIC8vIFRoZSBuYW1lIHRoZSBpbmZvcm1hdGlvbiBpcyBzdG9yZWQgdW5kZXIgc2hvdWxkIGJlIHByb3ZpZGVkIGFzIHRoZSBrZXkuCiAgLy8gSWYgbm8gY3VzdG9tIHBhY2tldCBkYXRhIGV4aXN0cyBmb3IgdGhlIGtleSwgbmlsIHNob3VsZCBiZSByZXR1cm5lZC4KICBHZXRDdXN0b21QYWNrZXREYXRhKGtleSBzdHJpbmcpIGludGVyZmFjZXt9Cn0K"}}),e._v(" "),t("p",[e._v("The callbacks middleware also "),t("strong",[e._v("requires")]),e._v(" the underlying ibc application's packet data type to implement the "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/release/v7.3.x/modules/core/exported/packet.go#L43-L52",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("PacketDataProvider")]),t("OutboundLink")],1),e._v(" interface. This interface is used to retrieve the callback data from the packet data (using the memo field in the case of "),t("code",[e._v("transfer")]),e._v(" and "),t("code",[e._v("ica")]),e._v("). For example, see its implementation in the "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/release/v7.3.x/modules/apps/transfer/types/packet.go#L85-L105",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("transfer")]),t("OutboundLink")],1),e._v(" module.")]),e._v(" "),t("p",[e._v("Since middlewares do not have packet types, they do not need to implement this interface.")]),e._v(" "),t("h3",{attrs:{id:"packetdata"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#packetdata"}},[e._v("#")]),e._v(" "),t("code",[e._v("PacketData")])]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gUGFja2V0RGF0YSBkZWZpbmVzIGFuIG9wdGlvbmFsIGludGVyZmFjZSB3aGljaCBhbiBhcHBsaWNhdGlvbidzIHBhY2tldCBkYXRhIHN0cnVjdHVyZSBtYXkgaW1wbGVtZW50Lgp0eXBlIFBhY2tldERhdGEgaW50ZXJmYWNlIHsKICAvLyBHZXRQYWNrZXRTZW5kZXIgcmV0dXJucyB0aGUgc2VuZGVyIGFkZHJlc3Mgb2YgdGhlIHBhY2tldCBkYXRhLgogIC8vIElmIHRoZSBwYWNrZXQgc2VuZGVyIGlzIHVua25vd24gb3IgdW5kZWZpbmVkLCBhbiBlbXB0eSBzdHJpbmcgc2hvdWxkIGJlIHJldHVybmVkLgogIEdldFBhY2tldFNlbmRlcihzb3VyY2VQb3J0SUQgc3RyaW5nKSBzdHJpbmcKfQo="}}),e._v(" "),t("p",[e._v("This is an optional interface that can be implemented by the underlying ibc application's packet data type. It is used to retrieve the packet sender address from the packet data. The callbacks middleware uses this interface to retrieve the packet sender address and pass it to the callback function during a source callback. If this interface is not implemented, then the callbacks middleware passes and empty string as the sender address. For example, see its implementation in the "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/release/v7.3.x/modules/apps/transfer/types/packet.go#L74-L83",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("transfer")]),t("OutboundLink")],1),e._v(" and "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/release/v7.3.x/modules/apps/27-interchain-accounts/types/packet.go#L78-L92",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("ica")]),t("OutboundLink")],1),e._v(" module.")]),e._v(" "),t("p",[e._v("This interface was added so that secondary applications can retrieve the packet sender address to perform custom authorization logic if needed.")]),e._v(" "),t("p",[e._v("Since middlewares do not have packet types, they do not need to implement this interface.")]),e._v(" "),t("h2",{attrs:{id:"interfaces-for-developing-the-secondary-application"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#interfaces-for-developing-the-secondary-application"}},[e._v("#")]),e._v(" Interfaces for developing the Secondary Application")]),e._v(" "),t("h3",{attrs:{id:"contractkeeper"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#contractkeeper"}},[e._v("#")]),e._v(" "),t("code",[e._v("ContractKeeper")])]),e._v(" "),t("p",[e._v("The callbacks middleware requires the secondary application to implement the "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/apps/callbacks/types/expected_keepers.go#L11-L64",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("ContractKeeper")]),t("OutboundLink")],1),e._v(" interface. The contract keeper will be invoked at each step of the packet lifecycle. When a packet is sent, if callback information is provided, the contract keeper will be invoked via the "),t("code",[e._v("IBCSendPacketCallback")]),e._v(". This allows the contract keeper to prevent packet sends when callback information is provided, for example if the sender is unauthroized to perform callbacks on the given information. If the packet send is successful, the contract keeper on the destination (if present) will be invoked when a packet has been received and the acknowledgement is written, this will occur via "),t("code",[e._v("IBCReceivePacketCallback")]),e._v(". At the end of the packet lifecycle, when processing acknowledgements or timeouts, the source contract keeper will be invoked either via "),t("code",[e._v("IBCOnAcknowledgementPacket")]),e._v(" or "),t("code",[e._v("IBCOnTimeoutPacket")]),e._v(". Once a packet has been sent, each step of the packet lifecycle can be processed given that a relayer sets the gas limit to be more than or equal to the required "),t("code",[e._v("CommitGasLimit")]),e._v(". State changes performed in the callback will only be committed upon successful execution.")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gQ29udHJhY3RLZWVwZXIgZGVmaW5lcyB0aGUgZW50cnkgcG9pbnRzIGV4cG9zZWQgdG8gdGhlIFZNIG1vZHVsZSB3aGljaCBpbnZva2VzIGEgc21hcnQgY29udHJhY3QKdHlwZSBDb250cmFjdEtlZXBlciBpbnRlcmZhY2UgewogIC8vIElCQ1NlbmRQYWNrZXRDYWxsYmFjayBpcyBjYWxsZWQgaW4gdGhlIHNvdXJjZSBjaGFpbiB3aGVuIGEgUGFja2V0U2VuZCBpcyBleGVjdXRlZC4gVGhlCiAgLy8gcGFja2V0U2VuZGVyQWRkcmVzcyBpcyBkZXRlcm1pbmVkIGJ5IHRoZSB1bmRlcmx5aW5nIG1vZHVsZSwgYW5kIG1heSBiZSBlbXB0eSBpZiB0aGUgc2VuZGVyIGlzCiAgLy8gdW5rbm93biBvciB1bmRlZmluZWQuIFRoZSBjb250cmFjdCBpcyBleHBlY3RlZCB0byBoYW5kbGUgdGhlIGNhbGxiYWNrIHdpdGhpbiB0aGUgdXNlciBkZWZpbmVkCiAgLy8gZ2FzIGxpbWl0LCBhbmQgaGFuZGxlIGFueSBlcnJvcnMsIG9yIHBhbmljcyBncmFjZWZ1bGx5LgogIC8vIElmIGFuIGVycm9yIGlzIHJldHVybmVkLCB0aGUgdHJhbnNhY3Rpb24gd2lsbCBiZSByZXZlcnRlZCBieSB0aGUgY2FsbGJhY2tzIG1pZGRsZXdhcmUsIGFuZCB0aGUKICAvLyBwYWNrZXQgd2lsbCBub3QgYmUgc2VudC4KICBJQkNTZW5kUGFja2V0Q2FsbGJhY2soCiAgICBjdHggc2RrLkNvbnRleHQsCiAgICBzb3VyY2VQb3J0IHN0cmluZywKICAgIHNvdXJjZUNoYW5uZWwgc3RyaW5nLAogICAgdGltZW91dEhlaWdodCBjbGllbnR0eXBlcy5IZWlnaHQsCiAgICB0aW1lb3V0VGltZXN0YW1wIHVpbnQ2NCwKICAgIHBhY2tldERhdGEgW11ieXRlLAogICAgY29udHJhY3RBZGRyZXNzLAogICAgcGFja2V0U2VuZGVyQWRkcmVzcyBzdHJpbmcsCiAgKSBlcnJvcgogIC8vIElCQ09uQWNrbm93bGVkZ2VtZW50UGFja2V0Q2FsbGJhY2sgaXMgY2FsbGVkIGluIHRoZSBzb3VyY2UgY2hhaW4gd2hlbiBhIHBhY2tldCBhY2tub3dsZWRnZW1lbnQKICAvLyBpcyByZWNlaXZlZC4gVGhlIHBhY2tldFNlbmRlckFkZHJlc3MgaXMgZGV0ZXJtaW5lZCBieSB0aGUgdW5kZXJseWluZyBtb2R1bGUsIGFuZCBtYXkgYmUgZW1wdHkgaWYKICAvLyB0aGUgc2VuZGVyIGlzIHVua25vd24gb3IgdW5kZWZpbmVkLiBUaGUgY29udHJhY3QgaXMgZXhwZWN0ZWQgdG8gaGFuZGxlIHRoZSBjYWxsYmFjayB3aXRoaW4gdGhlCiAgLy8gdXNlciBkZWZpbmVkIGdhcyBsaW1pdCwgYW5kIGhhbmRsZSBhbnkgZXJyb3JzLCBvciBwYW5pY3MgZ3JhY2VmdWxseS4KICAvLyBJZiBhbiBlcnJvciBpcyByZXR1cm5lZCwgc3RhdGUgd2lsbCBiZSByZXZlcnRlZCBieSB0aGUgY2FsbGJhY2tzIG1pZGRsZXdhcmUuCiAgSUJDT25BY2tub3dsZWRnZW1lbnRQYWNrZXRDYWxsYmFjaygKICAgIGN0eCBzZGsuQ29udGV4dCwKICAgIHBhY2tldCBjaGFubmVsdHlwZXMuUGFja2V0LAogICAgYWNrbm93bGVkZ2VtZW50IFtdYnl0ZSwKICAgIHJlbGF5ZXIgc2RrLkFjY0FkZHJlc3MsCiAgICBjb250cmFjdEFkZHJlc3MsCiAgICBwYWNrZXRTZW5kZXJBZGRyZXNzIHN0cmluZywKICApIGVycm9yCiAgLy8gSUJDT25UaW1lb3V0UGFja2V0Q2FsbGJhY2sgaXMgY2FsbGVkIGluIHRoZSBzb3VyY2UgY2hhaW4gd2hlbiBhIHBhY2tldCBpcyBub3QgcmVjZWl2ZWQgYmVmb3JlCiAgLy8gdGhlIHRpbWVvdXQgaGVpZ2h0LiBUaGUgcGFja2V0U2VuZGVyQWRkcmVzcyBpcyBkZXRlcm1pbmVkIGJ5IHRoZSB1bmRlcmx5aW5nIG1vZHVsZSwgYW5kIG1heSBiZQogIC8vIGVtcHR5IGlmIHRoZSBzZW5kZXIgaXMgdW5rbm93biBvciB1bmRlZmluZWQuIFRoZSBjb250cmFjdCBpcyBleHBlY3RlZCB0byBoYW5kbGUgdGhlIGNhbGxiYWNrCiAgLy8gd2l0aGluIHRoZSB1c2VyIGRlZmluZWQgZ2FzIGxpbWl0LCBhbmQgaGFuZGxlIGFueSBlcnJvciwgb3V0IG9mIGdhcywgb3IgcGFuaWNzIGdyYWNlZnVsbHkuCiAgLy8gSWYgYW4gZXJyb3IgaXMgcmV0dXJuZWQsIHN0YXRlIHdpbGwgYmUgcmV2ZXJ0ZWQgYnkgdGhlIGNhbGxiYWNrcyBtaWRkbGV3YXJlLgogIElCQ09uVGltZW91dFBhY2tldENhbGxiYWNrKAogICAgY3R4IHNkay5Db250ZXh0LAogICAgcGFja2V0IGNoYW5uZWx0eXBlcy5QYWNrZXQsCiAgICByZWxheWVyIHNkay5BY2NBZGRyZXNzLAogICAgY29udHJhY3RBZGRyZXNzLAogICAgcGFja2V0U2VuZGVyQWRkcmVzcyBzdHJpbmcsCiAgKSBlcnJvcgogIC8vIElCQ1JlY2VpdmVQYWNrZXRDYWxsYmFjayBpcyBjYWxsZWQgaW4gdGhlIGRlc3RpbmF0aW9uIGNoYWluIHdoZW4gYSBwYWNrZXQgYWNrbm93bGVkZ2VtZW50IGlzIHdyaXR0ZW4uCiAgLy8gVGhlIGNvbnRyYWN0IGlzIGV4cGVjdGVkIHRvIGhhbmRsZSB0aGUgY2FsbGJhY2sgd2l0aGluIHRoZSB1c2VyIGRlZmluZWQgZ2FzIGxpbWl0LCBhbmQgaGFuZGxlIGFueSBlcnJvcnMsCiAgLy8gb3V0IG9mIGdhcywgb3IgcGFuaWNzIGdyYWNlZnVsbHkuCiAgLy8gSWYgYW4gZXJyb3IgaXMgcmV0dXJuZWQsIHN0YXRlIHdpbGwgYmUgcmV2ZXJ0ZWQgYnkgdGhlIGNhbGxiYWNrcyBtaWRkbGV3YXJlLgogIElCQ1JlY2VpdmVQYWNrZXRDYWxsYmFjaygKICAgIGN0eCBzZGsuQ29udGV4dCwKICAgIHBhY2tldCBpYmNleHBvcnRlZC5QYWNrZXRJLAogICAgYWNrIGliY2V4cG9ydGVkLkFja25vd2xlZGdlbWVudCwKICAgIGNvbnRyYWN0QWRkcmVzcyBzdHJpbmcsCiAgKSBlcnJvcgp9Cg=="}}),e._v(" "),t("p",[e._v("These are the callback entry points exposed to the secondary application. The secondary application is expected to execute its custom logic within these entry points. The callbacks middleware will handle the execution of these callbacks and revert the state if needed.")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",[e._v("Note that the source callback entry points are provided with the "),t("code",[e._v("packetSenderAddress")]),e._v(" and MAY choose to use this to perform validation on the origin of a given packet. It is recommended to perform the same validation on all source chain callbacks (SendPacket, AcknowledgePacket, TimeoutPacket). This defensively guards against exploits due to incorrectly wired SendPacket ordering in IBC stacks.")])])],1)}),[],!1,null,null,null);a.default=l.exports}}]);